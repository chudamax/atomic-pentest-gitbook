# MSSQL Server Enumeration

## MSSQL Server Enumeration [t-ad-mssql-mssql_servers_enumeration]

Microsoft SQL Server is a relational database management system commonly found in Windows environments. They're typically used to store information to support a myriad of business functions. In addition to the obvious data theft opportunities, they also have a large attack surface, allowing code execution, privilege escalation, lateral movement and persistence.

### 1.1 Find instances and related domain groups




**option 1: PowerUpSQL.ps1**

{% code overflow="wrap" %}
```bash
Import-Module C:\Tools\PowerUpSQL\PowerUpSQL.ps1
Get-SQLInstanceDomain

```
{% endcode %}


**option 2: Powerview**

{% code overflow="wrap" %}
```bash
Get-DomainGroup -Identity *SQL* | % { Get-DomainGroupMember -Identity $_.distinguishedname | select groupname, membername }

```
{% endcode %}

### 1.2 Check for connection



{% code overflow="wrap" %}
```bash
Get-SQLInstanceDomain | Get-SQLConnectionTest | ? { $_.Status -eq "Accessible" } | Get-SQLServerInfo
Get-SQLQuery -Instance "sql-2.dev.cyberbotic.io,1433" -Query "select @@servername"

```
{% endcode %}

### 1.3 Check for roles, impersonation and additional information




**option 1: SQLRecon.exe**

{% code overflow="wrap" %}
```bash
SQLRecon.exe -a windows -s sql-2.dev.cyberbotic.io,1433 -m whoami
SQLRecon.exe -a windows -s sql-2.dev.cyberbotic.io,1433 -m impersonate
SQLRecon.exe -a windows -s sql-2.dev.cyberbotic.io,1433 -m links

```
{% endcode %}


**option 2: PowerUpSQL.ps1**

{% code overflow="wrap" %}
```bash
Get-SQLQuery -Instance "sql-2.dev.cyberbotic.io,1433" -Query "select @@servername"
#Impersonation
Get-SQLQuery -Instance "sql-2.dev.cyberbotic.io,1433" -Query "SELECT * FROM sys.server_permissions WHERE permission_name = 'IMPERSONATE';"
Get-SQLQuery -Instance "sql-2.dev.cyberbotic.io,1433" -Query "SELECT name, principal_id, type_desc, is_disabled FROM sys.server_principals;"

#Links
Get-SQLQuery -Instance "sql-2.dev.cyberbotic.io,1433" -Query "SELECT srvname, srvproduct, rpcout FROM master..sysservers;"

```
{% endcode %}


**option 3: impacket**

{% code overflow="wrap" %}
```bash
impacket-mssqlclient -windows-auth DEV/bfarmer@10.10.122.25

```
{% endcode %}

