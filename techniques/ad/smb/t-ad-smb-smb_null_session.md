# SMB Null Session Enumeration

## SMB Null Session Enumeration [t-ad-smb-smb_null_session]

When an SMB session is established anonymously or with a guest account, it is commonly referred to as an SMB null session. 
This can be used to anonymously access SMB shares or call RPC operations using the IPC$ share and named pipes.

In general, the session establishment steps are as follows:
  - Connect to the IPC$ share
  - Open a named pipe (e.g., \pipe\samr to access the SAM RPC server)
  - Bind to a DCE-RPC interface (identified by a UUID; authentication is already done at the SMB level)
  - Call RPC operations.

Interesting named pipes for NULL sessions:
  \pipe\samr: SAM (Security Account Manager) RPC server
  \pipe\lsarpc: LSA (Local Security Authority) RPC server
  \pipe\netlogon: Netlogon RPC server
  \pipe\svcctl: SCM (Service Control Manager) RPC server
  \pipe\eventlog: Eventlog service RPC server
  \pipe\srvsvc: Server service RPC server
  \pipe\wkssvc: Workstation service RPC server


### 1.1 Enumerate SMB Shares accessible for the null session (empty user and password)




**option 1: crackmapexec**

{% code overflow="wrap" %}
```bash
#empty user
crackmapexec smb <hosts_file or network/mask> -u '' -p '' --shares

#guest account
crackmapexec smb <hosts_file> -u 'guest' -p '' --shares

#access the SMB shares
smbclient -N //host.domain.com/Public

```
{% endcode %}


**option 2: smbmap**

{% code overflow="wrap" %}
```bash
#empty user
python3 smbmap.py -r --host-file hosts.txt -u '' -p '' --csv null_session_shares --no-write-check --exclude ADMIN$ C$ IPC$

#guest account
python3 smbmap.py -r --host-file hosts.txt -u 'guest' -p '' --csv guest_shares_$name --no-write-check --exclude ADMIN$ C$ IPC$

#access the SMB shares
smbclient -N //host.domain.com/Public

```
{% endcode %}


**option 3: smbclient**

{% code overflow="wrap" %}
```bash
#empty user
smbclient -N -L //host.com

#guest account

#access the SMB shares
smbclient -N //host.domain.com/Public

```
{% endcode %}

### 1.2 Enumerate host using RPC calls



{% code overflow="wrap" %}
```bash
#Use rpcclient help to see options to request more data
rpcclient -c querydispinfo -U''%'' dc.domain.local
```
{% endcode %}

