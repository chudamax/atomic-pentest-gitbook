# SMB Shares Discovery

## SMB Shares Discovery [t-ad-smb-smb_shares]

Sometimes companies do not restrict shares that contain sensitive data to only readable by 
certain groups, and are open to all authenticated users or even without providing credentials (null/guest sessions). 
Such resources can contain sensitive data, backups, passwords, configuration files, etc.


### 1.1 Enumerate publicly accessible SMB shares




**option 1: crackmapexec**

{% code overflow="wrap" %}
```bash
crackmapexec smb <hosts_file> -u user -p 'P@ssw0rd' --shares
cmedb
cmedb (test)(smb) > export shares detailed shares.csv

```
{% endcode %}


**option 2: powerview**

{% code overflow="wrap" %}
```bash
Find-DomainShare -CheckShareAccess
```
{% endcode %}


**option 3: smbmap**

{% code overflow="wrap" %}
```bash
python3 smbmap.py -r --host-file $name -u user -d domain -p P@ssw0rd --csv authenticated_shares_$name --no-write-check --exclude ADMIN$ C$ IPC$
```
{% endcode %}

{% hint style="info" %}Supports Pass-the-Hash

{% endhint %}


**option 4: smbclient**

{% code overflow="wrap" %}
```bash
smbclient -L -U domain.com\\username //host.com
```
{% endcode %}

### 1.2 Access the SMB shares



{% code overflow="wrap" %}
```bash
smbclient -U domain.com\\username //domain.com/sharename

#kerberos
impacket-smbclient -k domain/username:'P@ssw0rd'@dc.domain.com

```
{% endcode %}

